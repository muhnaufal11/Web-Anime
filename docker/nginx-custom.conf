# Gzip compression
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_min_length 1000;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml
    application/xml+rss
    application/x-javascript
    image/svg+xml
    font/woff
    font/woff2;

# Increase buffer sizes
client_body_buffer_size 16K;
client_header_buffer_size 4k;
large_client_header_buffers 4 16k;

# Increase timeouts
client_body_timeout 12;
client_header_timeout 12;
send_timeout 10;

# Enable open file cache
open_file_cache max=2000 inactive=30s;
open_file_cache_valid 60s;
open_file_cache_min_uses 2;
open_file_cache_errors on;

# Expires headers mapping
map $uri $expires_time {
    default                    off;
    ~*\.(jpg|jpeg|png|gif|ico|webp|svg)$ 1y;
    ~*\.(css|js)$              1y;
    ~*\.(woff|woff2|ttf|eot)$  1y;
    ~*/storage/.*              1y;
    ~*/img/.*                  1y;
    ~*/build/.*                1y;
}
